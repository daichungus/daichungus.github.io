<!DOCTYPE html>
<html>
<title>Touhou Linux Guide</title>
<body>
<h1>Touhou Linux Guide</h1>
<h2>By <a href="https://github.com/daichungus">Daichungus</a></h2>
<p id="last-updated"></p>
<script>
  document.getElementById("last-updated").textContent = "Last updated at " + document.lastModified;
</script>
<!--<a href="./pc98.html">PC-98 Touhou Linux Guide</a>-->
<h2>This is a work-in-progress!</h2>
<hr class="light">
<h1>Setup</h1>
<h2>Choosing a distro</h2>
    <p>Most major distros should work well with this guide.</p>
    <p>I use Fedora 42 with KDE for my personal setup, and have tested this process on Ubuntu 24.04 LTS with GNOME.</p>
    <p>My only recommendation is to choose a well-known, widely-supported, and stable distro, which includes but is not limited to the following:</p>
    <ul>
        <li><a href="https://linuxmint.com/">Linux Mint</a></li>
        <li><a href="https://ubuntu.com/desktop">Ubuntu</a></li>
        <li><a href="https://fedoraproject.org/">Fedora</a></li>
        <li><a href="https://www.debian.org/">Debian</a></li>
    </ul>
    <h3>NOTE: This guide does NOT cover Arch Linux!</h3>
<h2>Installing required software</h2>
    <ol>
        <li>Update your repository using your distro's included package manager.
            <p><b>Debian/Ubuntu/Linux Mint: </b></p>
            <p><code>sudo apt update && sudo apt upgrade</code></p>
            <p><b>Fedora: </b></p>
            <p><code>sudo dnf update</code></p>
        </li>
        <!--<li>If not already included, <a href="https://flathub.org/setup">install flatpak and add the flathub repo.</a></li>-->
        <li>Install Wine and Lutris.
            <p><b>Debian/Ubuntu/Linux Mint: </b></p>
            <p><code>sudo apt install wine lutris</code></p>
            <p><b>Fedora: </b></p>
            <p><code>sudo dnf install wine lutris</code></p>
        </li>
    </ol>
    <h2>Setting up Wine for THCRAP</h2>
    <p>You can skip this section if you do not plan on using THCRAP to download additional patches.</p>
    <p>NOTE: There will be warnings about using a 64-bit architecture prefix. Ignore them, or create a 32-bit prefix instead.</p>
    <ol>
        <li>Create a new Wine prefix with the following command. You can name it whatever you want other than <code>.wine</code>, but I highly recommend something memorable such as <code>.wine-thcrap</code>
            <p><code>WINEPREFIX=~/.wine-thcrap WINEARCH=win64 winecfg</code></p>
        </li>
        <li><a href="https://dl.winehq.org/wine/wine-mono/">Download</a> the latest version of Mono. Use <a href="https://gitlab.winehq.org/wine/wine/-/wikis/Wine-Mono#prefix-local-install">this guide</a> to find the version you need. You can also use Step 5 to check the version of Mono there.</li>
        <li>Launch winetricks for your new prefix with this command:
            <p><code>WINEPREFIX=~/.wine-thcrap winetricks</code></p>
        </li>
        <li>Once a window with the name "Winetricks - choose a wineprefix" appears, select "Select the default wineprefix" and press OK. Ensure the selected prefix is your created prefix.</li>
        <li>Select "Run uninstaller" and press OK.</li>
        <li>If there is already Wine Mono Runtime, remove it.</li>
        <li>"Install..." -> Location of your Mono <code>.msi</code> installer program -> Open</li>
        <li>Patiently wait until Mono has been fully installed.</li>
        <li>Exit the uninstaller.</li>
        <li>Cancel all Winetrick windows that pop up to entirely exit winetricks.</li>
    </ol>
<hr class="light">
<h1>Installing THCRAP patches</h1>
    <h3>Skip this section if you do not want to play with THCRAP patches, or if you already have THCRAP patches installed.</h3>
    <p><b>IMPORTANT NOTE: </b><code>thcrap_loader.exe</code> is the actual program that applies patches to the Touhou games,
        while <code>thcrap.exe</code> is the THCRAP configuration tool, which allows you to download new patches and locate the 
        games.
    </p>
    <p><b>NOTE: </b>if you want to run the THCRAP configuration tool with regular Wine, you have to install Mono to your Wine prefix. 
        This is because the THCRAP configuration tool depends on the .NET framework. Mono is the Linux equivalent of it. 
        <b>Without Mono, the THCRAP configuration tool will only display a bright pink window before closing itself.</b>
    </p>
    <h2>Setup of the THCRAP configuration tool</h2>
    <b>NOTE:</b> THCRAP's nature allows you be to patch any Touhou game in any location. However, it is <b style="color:red">highly recommended that the thcrap folder should be placed in the same location as your Touhou games.</b>
    <ol>
        <li><a href="https://www.thpatch.net/wiki/Touhou_Patch_Center:Download">Download the main THCRAP package from thpatch.net</a></li>
        <li>Unzip the package. There are two ways to do this:</li>
        <ul>
            <li>Use a GUI-based archive manager. Usually included with your distro. (Ark, File Roller, Engrampa, etc.)</li>
            <li>Use the <code>unzip</code> command. You may have to install it with your package manager. An example  of the command in use is shown below:
                <p><code>unzip thcrap.zip -d ~/yourname/Downloads/thcrap</code></p>
            </li>
        </ul>
        <li>Open Lutris, then add "locally installed game" with the "+" sign in the upper-left corner.</li>
        <li>You can set the name to be whatever you want, but "THCRAP configuration" is enough. Choose Wine as the Runner.</li>
        <li>Locate <code>thcrap.exe</code> for the executable path. (NOT <code>thcrap_loader.exe</code>!).</li>
        <li>Set the working directory path to be the same folder <code>thcrap.exe</code> is located in.</li>
        <li>Locate your newly created Wine prefix from the previous setup section.
        <li>Use System wine for the Runner option.</li>
        <li>Press the save button and ensure the THCRAP configuration tool runs properly.</li>
    </ol>
    <h2>Installing patches with the THCRAP configuration tool</h2>
    <ol>
        <li>Run the THCRAP configuration tool via Lutris.</li>
        <li>On the welcome screen, click next. By default, THCRAP will ask you to choose a patch based on your system's default language (most likely English).</li>
        <li>You can install multiple patches at the same time in the "All patches" tab. More detailed information can be found <a href="https://www.thpatch.net/wiki/Touhou_Patch_Center:Download#Setup_Instructions">here.</a>
            You can also set the "Config name" as you desire. More on that later.
        </li>
        <li>THCRAP will then ask you for the location of your games.
            <ol>
                <li>Select the "Find games in a specific folder" option.</li>
                <li>Navigate to the folder containing your Touhou games. The path should be something like 
                    <p><code>/home/yourname/Games/Touhou</code></p>
                </li>
                <li>THCRAP will then load a list of detected Touhou games and their settings program (<code>custom.exe</code>).</li>
                <li>Select the games you want to apply the patch to. Click Next.</li>
            </ol>
        </li>
        <li>You will be prompted to create a shortcut for the game in various possible locations. Choose the most convenient one for you.</li>
        <li>A shortcut for that patch will be created.
            <p>NOTE: This shortcut is purely optional, as what actually matters is the config file created for that patch. You can delete the shortcut if desired.</p>
        </li>
        <li>Run the shortcut with Wine, or skip to the "Running with existing THCRAP patches" section</li>
    </ol>
    <h2>Understanding and editing the config files</h2>
    <p>Config files tell <code>thcrap_loader.exe</code> which patches to load in order. These are located in the <code><b>config</b></code> folder of the <code><b>thcrap</b></code> folder ending with <code><b>.js</b></code></p>
    <p>All config files must follow a strict JSON format. An example for <code>en.js</code> is <a href="./patch_config_example.txt">provided here</a>.</p>
    <p>The listed patches follow a top-down order. Lower listed patches will stack on the above listed patches.</p>
    <p>If you have already have installed a few patches, this can be very useful for multi-patch loading.</p>
        <h3>About games.js</h3>
        <p><code>games.js</code> is a special config file compared to the other ones. This file basically lists all the locations of your Touhou games for THCRAP to find.</p>
        <p>A good example is <a href="./games_example.txt">provided here.</a></p>
        <p>If you have <code>vpatch.exe</code> in any of the games' folders (see "Running Touhou with Vsync patches"), you can refer to that instead of the regular game exe.</p>
        <p>It's best practice to refer the locations of the games via relative paths. This allows portability and less hassle compared to absolute paths. (hence the earlier recommendation of placing thcrap in the same folder as the games)</p>
<hr class="light">
<h1>Adding and running the Touhou games</h1>
    <h2>Running vanilla Touhou</h2>
    <p>Read this if you want to play without THCRAP patches or vpatch.</p>
    <ol>
        <li>Open Lutris, then add "locally installed game".</li>
        <li>Enter the game name. Choose Wine as the Runner.</li>
        <li>Locate your game's exe (usually thXX.exe) for the executable path.</li>
        <li>Set the working directory path to be the same folder the game is located in.</li>
        <li>Locate your Wine prefix. Usually this is located as <code>~/.wine</code></li>
        <li>For Runner options, use System wine.</li>
        <li>Press the save button and ensure your game is running.</li>
    </ol>
    <h2>Running Touhou with Vsync patches</h2>
    <p>Read this if you want to play with <a href="https://en.touhouwiki.net/wiki/Game_Tools_and_Modifications#Vsync_Patches">Vsync patches</a>.</p>
    <p><b>NOTE: The executable of EoSD should be renamed to <code>東方紅魔郷.exe</code></b></p>
    <p><b>NOTE:</b> While Vsync patch is not required for reducing input lag on Linux, it adds QoL features such as window resizing and fast-forwarding replays</p>
    <ol>
        <li>Repeat the same first few steps as running vanilla Touhou.</li>
        <li>Locate <code>vpatch.exe</code> for the executable path. The executable, <code>vpatch.ini</code>, and the appropriate <code>vpatch_thXX.dll</code> file should be in the same directory as the game you want to add.</li>
        <li>Continue with the same steps as running vanilla Touhou.</li>
        <li>Press the save button and ensure your game is running. If you changed the window size in <code>vpatch.ini</code>, the game's window should be that size.</li>
    </ol>
    <h2>Running with existing THCRAP patches</h2>
    <p>Read this if you already have downloaded THCRAP patches. (e.g. moving your games from Windows)</p>
    <ol>
        <li>Repeat the same steps as running vanilla Touhou, but for the executable path in Game options, locate <code>thcrap_loader.exe</code></li>
        <li>
            <p>In the Arguments field, enter the <code>.js</code> file of your patch and the name of the game you want to run it with. 
            You can find all of your installed patches and game locations in the <code>config</code> folder of your <code>thcrap</code> folder.</p>
            <p>Example: <code>en.js th06</code> for EoSD with the English patch.</p>
        </li>
        <li>Ensure the working directory is the folder that contains <code>thcrap_loader.exe</code>.</li>
        <li>Press the save button and ensure your game is running. There should be a small window that has the name "Touhou Community Reliant Automatic Patcher".</li>
        <li>If your game loads with your desired patch, you've succeeded.</li>
    </ol>
<hr class="light">
<h1>Post-Setup Tweaks</h1>
<i>This section is under construction.</i>
<hr class="light">
<h1>Additional Helpful Resources</h1>
    <ul>
        <li><a href="https://en.touhouwiki.net/wiki/Running_in_Linux_and_macOS">Touhou Wiki guide</a></li>
        <li><a href="https://wiki.archlinux.org/title/Touhou">ArchWiki guide</a></li>
        <li><a href="https://www.thpatch.net/wiki/Touhou_Patch_Center:Wine_tips">Touhou Patch Center: Wine tips</a></li>
        <li><a href="https://www.thpatch.net/wiki/Touhou_Patch_Center:Download">General THCRAP guide</a></li>
        <li><a href="https://github.com/scriptkitties/fglt/blob/master/_guides/playing-zun-touhou-games-on-gnu-linux-with-wine.md">scriptkitties guide (Uses Arch and PlayOnLinux)</a></li>
        <li><a href="https://hisouten.koumakan.jp/wiki/Linux_support">Guide to running Hisoutensoku</a></li>
        <li><a href="https://touhouprojects.com/emulators/wine/">Directly using Wine to run Touhou games</a></li>
        <li><a href="https://lilyremigia.moe/installtouhou/">lilyremigia's guide on running THCRAP</a></li>
    </ul>
</body>
</html>